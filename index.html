<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Server Fleet Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Light gray background */
            color: #1f2937; /* Dark text */
        }
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.5);
        }
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        /* Style for sortable table headers */
        .sortable-header {
            cursor: pointer;
            user-select: none;
            position: relative;
            padding-right: 20px;
        }
        .sort-indicator {
            position: absolute;
            right: 4px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.2em;
            color: #9ca3af;
        }
        .sort-indicator.asc, .sort-indicator.desc {
            color: #1f2937;
        }
    </style>
</head>
<body class="antialiased">

    <div id="app" class="p-4 sm:p-6 lg:p-8 max-w-7xl mx-auto">
        <!-- Header -->
        <header class="mb-8">
            <h1 class="text-3xl font-bold text-gray-900 tracking-tight">Server Fleet Dashboard</h1>
            <p class="text-gray-600 mt-1">An interactive dashboard to track and manage your servers.</p>
        </header>

        <!-- Summary Cards -->
        <div id="summary-cards" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-7 gap-4 mb-6">
            <!-- Summary cards will be injected here by JavaScript -->
        </div>

        <!-- Controls and Filters -->
        <div class="mb-6 bg-white p-4 rounded-lg border border-gray-200 shadow-sm">
            <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4">
                <!-- Search Input -->
                <div class="lg:col-span-2">
                    <label for="search-input" class="block text-sm font-medium text-gray-700">Search</label>
                    <input type="search" id="search-input" placeholder="Search by ID, provider, details..." class="mt-1 bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                </div>
                <!-- Status Filter -->
                <div>
                    <label for="status-filter" class="block text-sm font-medium text-gray-700">Filter by Status</label>
                    <select id="status-filter" class="mt-1 bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                        <!-- Filter options will be injected here -->
                    </select>
                </div>
                <!-- Provider Filter -->
                <div>
                    <label for="provider-filter" class="block text-sm font-medium text-gray-700">Filter by Provider</label>
                    <select id="provider-filter" class="mt-1 bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                        <!-- Provider options will be injected here -->
                    </select>
                </div>
            </div>
            <div class="flex flex-col sm:flex-row justify-end items-center mt-4 pt-4 border-t border-gray-200">
                <button id="clear-filters-btn" class="w-full sm:w-auto mb-2 sm:mb-0 sm:mr-4 text-gray-700 bg-white hover:bg-gray-100 border border-gray-300 font-medium py-2 px-4 rounded-lg transition duration-300 text-sm">Clear Filters</button>
                <button id="add-server-btn" class="w-full sm:w-auto flex items-center justify-center bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300 text-sm">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
                    Add New Server
                </button>
            </div>
        </div>

        <!-- Server Table Container -->
        <div class="bg-white rounded-lg border border-gray-200 shadow-sm overflow-hidden">
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th scope="col" class="sortable-header px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-sort="id">Server ID<span class="sort-indicator"></span></th>
                            <th scope="col" class="sortable-header px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-sort="status">Status<span class="sort-indicator"></span></th>
                            <th scope="col" class="sortable-header px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-sort="provider">Provider<span class="sort-indicator"></span></th>
                            <th scope="col" class="sortable-header px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-sort="infra">Infrastructure<span class="sort-indicator"></span></th>
                            <th scope="col" class="sortable-header px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-sort="details">Details<span class="sort-indicator"></span></th>
                            <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="server-table-body" class="bg-white divide-y divide-gray-200">
                        <!-- Server rows will be dynamically inserted here -->
                    </tbody>
                </table>
                 <div id="no-results" class="text-center py-12 text-gray-500 hidden">
                    <p class="text-lg">No servers found.</p>
                    <p class="text-sm">Try adjusting your search or filters.</p>
                </div>
            </div>
        </div>
        
        <!-- Pagination Controls -->
        <div id="pagination-controls" class="flex flex-col sm:flex-row items-center justify-between mt-4 px-4 py-2 bg-white rounded-lg border border-gray-200 shadow-sm">
            <div class="flex items-center space-x-2 text-sm text-gray-700">
                <span>Rows per page:</span>
                <select id="rows-per-page" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-md focus:ring-blue-500 focus:border-blue-500 p-1">
                    <option value="10">10</option>
                    <option value="25">25</option>
                    <option value="50">50</option>
                    <option value="100">100</option>
                </select>
            </div>
            <div class="flex items-center space-x-4 mt-2 sm:mt-0">
                <span id="page-info" class="text-sm text-gray-700"></span>
                <div class="flex items-center space-x-1">
                    <button id="prev-page-btn" class="px-3 py-1 text-sm font-medium text-gray-600 bg-white border border-gray-300 rounded-md hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed">Previous</button>
                    <button id="next-page-btn" class="px-3 py-1 text-sm font-medium text-gray-600 bg-white border border-gray-300 rounded-md hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed">Next</button>
                </div>
            </div>
        </div>

        <footer class="text-center text-gray-500 text-xs mt-6">
            <p>Your data is automatically saved in your browser's local storage.</p>
        </footer>
    </div>

    <!-- Add/Edit Server Modal -->
    <div id="server-modal" class="fixed inset-0 z-50 flex items-center justify-center modal-backdrop hidden">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md m-4 border border-gray-200">
            <form id="server-form" class="p-6">
                <h2 id="modal-title" class="text-2xl font-bold text-gray-900 mb-6">Add New Server</h2>
                <input type="hidden" id="server-id-hidden">
                
                <div class="mb-4">
                    <label for="server-id" class="block mb-2 text-sm font-medium text-gray-700">Server ID</label>
                    <input type="text" id="server-id" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" placeholder="e.g., sl2190" required>
                </div>

                <div class="mb-4">
                    <label for="server-status" class="block mb-2 text-sm font-medium text-gray-700">Status</label>
                    <select id="server-status" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" required>
                        <!-- Status options will be populated by JS -->
                    </select>
                </div>

                <div class="mb-4">
                    <label for="server-provider" class="block mb-2 text-sm font-medium text-gray-700">Provider</label>
                    <input type="text" id="server-provider" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" placeholder="e.g., Scaleway">
                </div>
                
                <div class="mb-4">
                    <label for="server-infra" class="block mb-2 text-sm font-medium text-gray-700">Infrastructure</label>
                    <input type="text" id="server-infra" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" placeholder="e.g., OVH (optional)">
                </div>

                <div class="mb-6">
                    <label for="server-details" class="block mb-2 text-sm font-medium text-gray-700">Details</label>
                    <textarea id="server-details" rows="3" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" placeholder="e.g., Down (ticket opened)"></textarea>
                </div>
                
                <div class="flex justify-end space-x-4">
                    <button type="button" id="cancel-btn" class="py-2.5 px-5 text-sm font-medium text-gray-700 bg-white hover:bg-gray-100 rounded-lg border border-gray-300 focus:outline-none focus:ring-4 focus:ring-gray-200 transition">Cancel</button>
                    <button type="submit" id="save-btn" class="text-white bg-blue-600 hover:bg-blue-700 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center transition">Save Server</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Delete Confirmation Modal -->
    <div id="delete-modal" class="fixed inset-0 z-50 flex items-center justify-center modal-backdrop hidden">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md m-4 border border-gray-200 p-6 text-center">
            <svg class="mx-auto mb-4 text-gray-400 w-12 h-12" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20">
                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 11V6m0 8h.01M19 10a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"/>
            </svg>
            <h3 class="mb-5 text-lg font-normal text-gray-700">Are you sure you want to delete this server?</h3>
            <p id="delete-server-info" class="mb-5 text-sm font-bold text-gray-900"></p>
            <button id="confirm-delete-btn" type="button" class="text-white bg-red-600 hover:bg-red-700 focus:ring-4 focus:outline-none focus:ring-red-300 font-medium rounded-lg text-sm inline-flex items-center px-5 py-2.5 text-center mr-2">
                Yes, I'm sure
            </button>
            <button id="cancel-delete-btn" type="button" class="text-gray-600 bg-white hover:bg-gray-100 focus:ring-4 focus:outline-none focus:ring-gray-200 rounded-lg border border-gray-300 text-sm font-medium px-5 py-2.5 hover:text-gray-900 focus:z-10">
                No, cancel
            </button>
        </div>
    </div>


<script>
document.addEventListener('DOMContentLoaded', () => {

    // --- INITIAL DATA & CONFIG ---
    const initialData = [
        {id: "sl2023", status: "Production", provider: "Scaleway", infra: "", details: ""},
        {id: "sl2150", status: "Production", provider: "Ovh.pt", infra: "OVH", details: ""},
        {id: "sl2151", status: "Production", provider: "Ovh.pt", infra: "OVH", details: ""},
        {id: "sl2156", status: "Production", provider: "Ovh.pt", infra: "OVH", details: ""},
        {id: "sl2157", status: "Production", provider: "Ovh.pt", infra: "OVH", details: ""},
        {id: "sl2168", status: "Production", provider: "Ovh.pt", infra: "OVH", details: ""},
        {id: "sl2106", status: "Production", provider: "vertichost", infra: "OVH", details: ""},
        {id: "sl2149", status: "Production", provider: "Ovh.pt", infra: "OVH", details: ""},
        {id: "sl2169", status: "Production", provider: "Ovh.pt", infra: "OVH", details: ""},
        {id: "sl2170", status: "Production", provider: "Ovh.pt", infra: "OVH", details: ""},
        {id: "sl2187", status: "Warmup", provider: "Donweb", infra: "", details: ""},
        {id: "sl2188", status: "Warmup", provider: "Donweb", infra: "", details: ""},
        {id: "sl2189", status: "Warmup", provider: "Donweb", infra: "", details: ""},
        {id: "sl1983", status: "Testing", provider: "Scaleway", infra: "", details: ""},
        {id: "sl2137", status: "Testing", provider: "Webdesignlabs", infra: "Hetzner", details: ""},
        {id: "sl1560", status: "To Be Tested", provider: "Online.net", infra: "", details: ""},
        {id: "sl1963", status: "To Be Tested", provider: "1and1", infra: "", details: ""},
        {id: "sl2026", status: "To Be Tested", provider: "Scaleway", infra: "", details: ""},
        {id: "sl2180", status: "To Be Tested", provider: "Scaleway", infra: "", details: ""},
        {id: "sl2181", status: "To Be Tested", provider: "Lease Web", infra: "", details: ""},
        {id: "sl2182", status: "To Be Tested", provider: "Scaleway", infra: "", details: ""},
        {id: "sl2183", status: "To Be Tested", provider: "Webdesignlabs", infra: "Hetzner", details: ""},
        {id: "sl2184", status: "To Be Tested", provider: "Ovh.pt", infra: "", details: ""},
        {id: "sl2185", status: "To Be Tested", provider: "Lease Web", infra: "", details: ""},
        {id: "sl1538", status: "Issues", provider: "Scaleway", infra: "", details: "Down (opened ticket)"},
        {id: "sl1965", status: "Issues", provider: "Ovh.pt", infra: "OVH", details: "Timed out (opened ticket)"},
        {id: "sl2186", status: "Issues", provider: "Ovh.pt", infra: "", details: "Timed out (opened ticket)"},
        {id: "sl2155", status: "To-Return", provider: "Ovh.pt", infra: "", details: "to return"},
        {id: "sl2176", status: "To-Return", provider: "Ni-Host", infra: "OVH", details: "Timed-out (to return)"},
        {id: "sl1812", status: "To-Return", provider: "", infra: "", details: ""},
        {id: "sl1960", status: "To-Return", provider: "", infra: "", details: ""},
        {id: "sl1997", status: "To-Return", provider: "", infra: "", details: ""},
        {id: "sl2007", status: "To-Return", provider: "", infra: "", details: ""},
        {id: "sl2079", status: "To-Return", provider: "", infra: "", details: ""},
        {id: "sl2171", status: "To-Return", provider: "", infra: "", details: ""},
        {id: "sl2174", status: "To-Return", provider: "", infra: "", details: ""},
        {id: "sl2160", status: "Reserved", provider: "", infra: "", details: "Reserved for Others Team"},
        {id: "sl2162", status: "Reserved", provider: "", infra: "", details: "Reserved for Others Team"},
        {id: "sl2164", status: "Reserved", provider: "", infra: "", details: "Reserved for Others Team"}
    ];

    const STATUSES = {
        "Production": { color: "bg-green-500", title: "Production" },
        "Warmup": { color: "bg-yellow-400", title: "Warmup" },
        "Testing": { color: "bg-blue-500", title: "Limit (Testing)" },
        "To Be Tested": { color: "bg-indigo-500", title: "To Be Tested" },
        "Issues": { color: "bg-red-500", title: "Issues" },
        "To-Return": { color: "bg-gray-500", title: "To-Return" },
        "Reserved": { color: "bg-purple-500", title: "Reserved" }
    };

    // --- DOM ELEMENTS ---
    const serverTableBody = document.getElementById('server-table-body');
    const summaryCardsContainer = document.getElementById('summary-cards');
    const statusFilter = document.getElementById('status-filter');
    const providerFilter = document.getElementById('provider-filter');
    const searchInput = document.getElementById('search-input');
    const serverModal = document.getElementById('server-modal');
    const serverForm = document.getElementById('server-form');
    const modalTitle = document.getElementById('modal-title');
    const hiddenServerId = document.getElementById('server-id-hidden');
    const serverIdInput = document.getElementById('server-id');
    const serverStatusSelect = document.getElementById('server-status');
    const noResultsDiv = document.getElementById('no-results');
    const deleteModal = document.getElementById('delete-modal');
    const confirmDeleteBtn = document.getElementById('confirm-delete-btn');
    const cancelDeleteBtn = document.getElementById('cancel-delete-btn');
    const clearFiltersBtn = document.getElementById('clear-filters-btn');
    const paginationControls = document.getElementById('pagination-controls');
    const prevPageBtn = document.getElementById('prev-page-btn');
    const nextPageBtn = document.getElementById('next-page-btn');
    const pageInfo = document.getElementById('page-info');
    const rowsPerPageSelect = document.getElementById('rows-per-page');
    
    let servers = [];
    let serverToDeleteId = null;
    let currentSort = { column: 'id', direction: 'asc' };
    let currentPage = 1;
    let rowsPerPage = 10;

    // --- DATA HANDLING ---
    const loadServers = () => {
        const storedServers = localStorage.getItem('serverFleetData');
        if (storedServers) {
            servers = JSON.parse(storedServers);
        } else {
            servers = initialData;
            saveServers();
        }
    };

    const saveServers = () => {
        localStorage.setItem('serverFleetData', JSON.stringify(servers));
    };

    // --- RENDERING FUNCTIONS ---
    const renderTable = () => {
        serverTableBody.innerHTML = '';
        
        // 1. Filtering
        const statusFilterValue = statusFilter.value;
        const providerFilterValue = providerFilter.value;
        const searchValue = searchInput.value.toLowerCase();

        let filteredServers = servers.filter(server => {
            const statusMatch = statusFilterValue === 'All' || server.status === statusFilterValue;
            const providerMatch = providerFilterValue === 'All' || server.provider === providerFilterValue;
            const searchMatch = !searchValue || Object.values(server).some(val => 
                String(val).toLowerCase().includes(searchValue)
            );
            return statusMatch && providerMatch && searchMatch;
        });

        // 2. Sorting
        filteredServers.sort((a, b) => {
            const valA = a[currentSort.column] || '';
            const valB = b[currentSort.column] || '';
            
            if (valA < valB) return currentSort.direction === 'asc' ? -1 : 1;
            if (valA > valB) return currentSort.direction === 'asc' ? 1 : -1;
            return 0;
        });
        
        // 3. Pagination
        const totalRows = filteredServers.length;
        const totalPages = Math.ceil(totalRows / rowsPerPage);
        if (currentPage > totalPages && totalPages > 0) {
            currentPage = totalPages;
        }
        const startIndex = (currentPage - 1) * rowsPerPage;
        const paginatedServers = filteredServers.slice(startIndex, startIndex + rowsPerPage);

        // 4. Update UI based on results
        noResultsDiv.classList.toggle('hidden', totalRows > 0);
        paginationControls.classList.toggle('hidden', totalRows === 0);

        // 5. Render Rows
        paginatedServers.forEach(server => {
            const statusInfo = STATUSES[server.status] || { color: 'bg-gray-400' };
            const row = `
                <tr class="hover:bg-gray-50 transition-colors duration-200">
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${server.id}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">
                        <span class="flex items-center">
                            <span class="status-dot ${statusInfo.color}"></span>
                            ${server.status}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">${server.provider || 'N/A'}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">${server.infra || 'N/A'}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 max-w-xs truncate" title="${server.details}">${server.details || '-'}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                        <button class="edit-btn text-indigo-600 hover:text-indigo-900 mr-4" data-id="${server.id}">Edit</button>
                        <button class="delete-btn text-red-600 hover:text-red-900" data-id="${server.id}">Delete</button>
                    </td>
                </tr>
            `;
            serverTableBody.innerHTML += row;
        });

        updateSortIndicators();
        renderPagination(totalRows, startIndex);
    };
    
    const renderPagination = (totalRows, startIndex) => {
        const totalPages = Math.ceil(totalRows / rowsPerPage);
        const startRow = totalRows > 0 ? startIndex + 1 : 0;
        const endRow = Math.min(startIndex + rowsPerPage, totalRows);

        pageInfo.textContent = totalRows > 0 ? `Showing ${startRow} to ${endRow} of ${totalRows} results` : '';
       
        prevPageBtn.disabled = currentPage === 1;
        nextPageBtn.disabled = currentPage === totalPages || totalPages === 0;
    };

    const updateSortIndicators = () => {
        document.querySelectorAll('.sortable-header').forEach(header => {
            const indicator = header.querySelector('.sort-indicator');
            const column = header.dataset.sort;
            indicator.innerHTML = '';
            indicator.classList.remove('asc', 'desc');

            if (column === currentSort.column) {
                indicator.innerHTML = currentSort.direction === 'asc' ? '▲' : '▼';
                indicator.classList.add(currentSort.direction);
            }
        });
    };

    const renderSummary = () => {
        summaryCardsContainer.innerHTML = '';
        const statusCounts = servers.reduce((acc, server) => {
            acc[server.status] = (acc[server.status] || 0) + 1;
            return acc;
        }, {});

        const totalCard = `
            <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm">
                <p class="text-sm font-medium text-gray-500">Total Servers</p>
                <p class="mt-1 text-3xl font-semibold text-gray-900">${servers.length}</p>
            </div>`;
        summaryCardsContainer.innerHTML += totalCard;

        Object.keys(STATUSES).forEach(status => {
            const count = statusCounts[status] || 0;
            const statusInfo = STATUSES[status];
            const card = `
                <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm">
                    <div class="flex items-center">
                        <span class="status-dot ${statusInfo.color}"></span>
                        <p class="text-sm font-medium text-gray-500">${statusInfo.title}</p>
                    </div>
                    <p class="mt-1 text-3xl font-semibold text-gray-900">${count}</p>
                </div>
            `;
            summaryCardsContainer.innerHTML += card;
        });
    };

    const populateFiltersAndSelects = () => {
        // Status filter
        statusFilter.innerHTML = '<option value="All">All Statuses</option>';
        serverStatusSelect.innerHTML = '';
        Object.keys(STATUSES).forEach(status => {
            const option = `<option value="${status}">${status}</option>`;
            statusFilter.innerHTML += option;
            serverStatusSelect.innerHTML += option;
        });
        
        // Provider filter
        providerFilter.innerHTML = '<option value="All">All Providers</option>';
        const providers = [...new Set(servers.map(s => s.provider).filter(p => p))].sort();
        providers.forEach(provider => {
            providerFilter.innerHTML += `<option value="${provider}">${provider}</option>`;
        });
    };

    // --- MODAL HANDLING ---
    const showModal = (server = null) => {
        serverForm.reset();
        if (server) {
            modalTitle.textContent = 'Edit Server';
            hiddenServerId.value = server.id;
            serverIdInput.value = server.id;
            serverIdInput.disabled = true;
            document.getElementById('server-status').value = server.status;
            document.getElementById('server-provider').value = server.provider;
            document.getElementById('server-infra').value = server.infra;
            document.getElementById('server-details').value = server.details;
        } else {
            modalTitle.textContent = 'Add New Server';
            hiddenServerId.value = '';
            serverIdInput.disabled = false;
        }
        serverModal.classList.remove('hidden');
    };

    const hideModal = () => serverModal.classList.add('hidden');
    const showDeleteModal = (id) => {
        serverToDeleteId = id;
        const server = servers.find(s => s.id === id);
        document.getElementById('delete-server-info').textContent = `${server.id} (${server.provider || 'N/A'})`;
        deleteModal.classList.remove('hidden');
    };
    const hideDeleteModal = () => {
        serverToDeleteId = null;
        deleteModal.classList.add('hidden');
    };

    // --- EVENT LISTENERS ---
    document.getElementById('add-server-btn').addEventListener('click', () => showModal());
    document.getElementById('cancel-btn').addEventListener('click', hideModal);
    
    const addFilterListener = (element) => {
        element.addEventListener('input', () => { // Using 'input' for search to be more responsive
            currentPage = 1;
            renderTable();
        });
    };
    [statusFilter, providerFilter, searchInput].forEach(addFilterListener);
    
    rowsPerPageSelect.addEventListener('change', (e) => {
        rowsPerPage = parseInt(e.target.value, 10);
        currentPage = 1;
        renderTable();
    });

    prevPageBtn.addEventListener('click', () => {
        if (currentPage > 1) {
            currentPage--;
            renderTable();
        }
    });

    nextPageBtn.addEventListener('click', () => {
        // The disabled logic in renderPagination prevents going too far
        currentPage++;
        renderTable();
    });
    
    clearFiltersBtn.addEventListener('click', () => {
        statusFilter.value = 'All';
        providerFilter.value = 'All';
        searchInput.value = '';
        currentSort = { column: 'id', direction: 'asc' };
        currentPage = 1;
        renderTable();
    });

    document.querySelectorAll('.sortable-header').forEach(header => {
        header.addEventListener('click', () => {
            const column = header.dataset.sort;
            if (currentSort.column === column) {
                currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
            } else {
                currentSort.column = column;
                currentSort.direction = 'asc';
            }
            renderTable();
        });
    });

    serverForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const id = serverIdInput.value.trim();
        if (!id) return;
        const existingId = hiddenServerId.value;

        const serverData = {
            id: id,
            status: document.getElementById('server-status').value,
            provider: document.getElementById('server-provider').value,
            infra: document.getElementById('server-infra').value,
            details: document.getElementById('server-details').value,
        };

        if (existingId) { // Editing
            const index = servers.findIndex(s => s.id === existingId);
            if (index !== -1) servers[index] = serverData;
        } else { // Adding
            if (servers.some(s => s.id === id)) {
                alert("Error: A server with this ID already exists.");
                return;
            }
            servers.push(serverData);
        }

        saveServers();
        refreshUI();
        hideModal();
    });

    serverTableBody.addEventListener('click', (e) => {
        if (e.target.classList.contains('edit-btn')) {
            const id = e.target.dataset.id;
            const server = servers.find(s => s.id === id);
            if (server) showModal(server);
        }
        if (e.target.classList.contains('delete-btn')) {
            const id = e.target.dataset.id;
            showDeleteModal(id);
        }
    });
    
    confirmDeleteBtn.addEventListener('click', () => {
        if (serverToDeleteId) {
            servers = servers.filter(s => s.id !== serverToDeleteId);
            saveServers();
            refreshUI();
            hideDeleteModal();
        }
    });
    cancelDeleteBtn.addEventListener('click', hideDeleteModal);

    document.addEventListener('keydown', (e) => {
        if (e.key === "Escape") {
            hideModal();
            hideDeleteModal();
        }
    });

    // --- INITIALIZATION ---
    const refreshUI = () => {
        renderSummary();
        populateFiltersAndSelects();
        renderTable();
    };

    const init = () => {
        loadServers();
        rowsPerPageSelect.value = rowsPerPage;
        refreshUI();
    };



    init();
});
</script>
</body>
</html>

